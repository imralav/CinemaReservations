<?xml version="1.0" encoding="UTF-8"?>
<vxml version="2.1" xml:lang="pl-pl">
    <meta name="maintainer" content="imralav@gmail.com" />
    <script th:inline="javascript">
        /*<![CDATA[*/
            var date = /*[[${date}]]*/ null;
            var readableDate = /*[[${readableDate}]]*/ null;
            var movieTitle = /*[[${movieTitle}]]*/ null;
            var timeToShowingIdMap = /*[[${timeToShowingIdMap}]]*/ {};
        /*]]>*/
        function isTimeCorrect(time) {
            return timeToShowingIdMap[time] != undefined;
        }
        function getShowingIdForTime(time) {
            return timeToShowingIdMap[time];
        }
    </script>
    <form>
        <field name="choice">
            <grammar xml:lang="pl-pl" root="TIME_INDEXES" mode="voice" type="application/srgs+xml" tag-format="semantics/1.0">
                <rule id="TIME_INDEXES">
                    <one-of>
                        <item><ruleref uri="date.xml"/></item>
                        <item>powtórz</item>
                        <item>powrót</item>
                    </one-of>
                </rule>
            </grammar>
            <prompt>W wybranum dniu film <value expr="movieTitle"/> ma następujące seanse:</prompt>
            <prompt th:each="showing : ${showings}" th:text="${showing.readableTime} + '.'"></prompt>
            <prompt>Wypowiedz numer seansu, lub POWTÓRZ, by przeczytać listę seansów ponownie lub POWRÓT, by wrócić do początku rezerwacji.</prompt>
            <filled>
                <if cond="choice==='powtórz'">
                    <clear/>
                <elseif cond="choice==='powrót'"/>
                    <goto next="/cv/reservation/choicePrompt"/>
                <else/>
                    <if cond="isTimeCorrect(choice)">
                        <var name="showingId" expr="getShowingIdForTime(choice)"/>
                        <submit next="/cv/reservation/seatsPrompt" namelist="readableDate showingId"/>
                    <else/>
                        <prompt>O godzinie <value expr="choice"/> nie ma seansu. Spróbuj ponownie.</prompt>
                        <clear/>
                    </if>
                </if>
            </filled>
            <nomatch>
                <prompt>Nie rozpoznano wyboru, proszę spróbować ponownie.</prompt>
                <reprompt />
            </nomatch>
            <noinput>
                <prompt>Nie usłyszano wyboru, proszę spróbować ponownie.</prompt>
                <reprompt />
            </noinput>
        </field>
    </form>
</vxml>